<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chinacoal.ins.proposal.car.dao.GuPolicyItemKindMapper">
  <resultMap id="BaseResultMap" type="com.chinacoal.ins.proposal.car.pojo.GuPolicyItemKind">
    <id column="POLICYNO" jdbcType="VARCHAR" property="policyno" />
    <id column="RISKCODE" jdbcType="VARCHAR" property="riskcode" />
    <id column="PLANCODE" jdbcType="VARCHAR" property="plancode" />
    <result column="ITEMKINDNO" jdbcType="DECIMAL" property="itemkindno" />
    <result column="ITEMNO" jdbcType="DECIMAL" property="itemno" />
    <result column="ITEMCODE" jdbcType="VARCHAR" property="itemcode" />
    <result column="ITEMDETAILNO" jdbcType="DECIMAL" property="itemdetailno" />
    <result column="ITEMDETAILCODE" jdbcType="VARCHAR" property="itemdetailcode" />
    <result column="ITEMDETAILLIST" jdbcType="VARCHAR" property="itemdetaillist" />
    <result column="PROJECTCODE" jdbcType="VARCHAR" property="projectcode" />
    <result column="LIABCODE" jdbcType="VARCHAR" property="liabcode" />
    <result column="KINDCODE" jdbcType="VARCHAR" property="kindcode" />
    <result column="KINDNAME" jdbcType="VARCHAR" property="kindname" />
    <result column="MODECODE" jdbcType="VARCHAR" property="modecode" />
    <result column="MODENAME" jdbcType="VARCHAR" property="modename" />
    <result column="STARTDATE" jdbcType="TIMESTAMP" property="startdate" />
    <result column="ENDDATE" jdbcType="TIMESTAMP" property="enddate" />
    <result column="CALCULATEIND" jdbcType="VARCHAR" property="calculateind" />
    <result column="CURRENCY" jdbcType="VARCHAR" property="currency" />
    <result column="UNITVALUE" jdbcType="DECIMAL" property="unitvalue" />
    <result column="UNITINSURED" jdbcType="DECIMAL" property="unitinsured" />
    <result column="UNITPREMIUM" jdbcType="DECIMAL" property="unitpremium" />
    <result column="QUANTITY" jdbcType="DECIMAL" property="quantity" />
    <result column="UNIT" jdbcType="VARCHAR" property="unit" />
    <result column="SUMVALUE" jdbcType="DECIMAL" property="sumvalue" />
    <result column="SUMINSURED" jdbcType="DECIMAL" property="suminsured" />
    <result column="RATEPERIOD" jdbcType="DECIMAL" property="rateperiod" />
    <result column="RATE" jdbcType="DECIMAL" property="rate" />
    <result column="SHORTRATEFLAG" jdbcType="VARCHAR" property="shortrateflag" />
    <result column="SHORTRATE" jdbcType="DECIMAL" property="shortrate" />
    <result column="SHORTRATENUMERATOR" jdbcType="DECIMAL" property="shortratenumerator" />
    <result column="SHORTRATEDENOMINATOR" jdbcType="DECIMAL" property="shortratedenominator" />
    <result column="BASEPREMIUM" jdbcType="DECIMAL" property="basepremium" />
    <result column="BENCHMARKPREMIUM" jdbcType="DECIMAL" property="benchmarkpremium" />
    <result column="LOADING" jdbcType="DECIMAL" property="loading" />
    <result column="GROSSPREMIUM" jdbcType="DECIMAL" property="grosspremium" />
    <result column="DISCOUNT" jdbcType="DECIMAL" property="discount" />
    <result column="ADJUSTRATE" jdbcType="DECIMAL" property="adjustrate" />
    <result column="NETPREMIUM" jdbcType="DECIMAL" property="netpremium" />
    <result column="DEDUCTIBLERATE" jdbcType="DECIMAL" property="deductiblerate" />
    <result column="DEDUCTIBLE" jdbcType="DECIMAL" property="deductible" />
    <result column="PREMIUMFORMULA" jdbcType="VARCHAR" property="premiumformula" />
    <result column="YEARPREMIUM" jdbcType="DECIMAL" property="yearpremium" />
    <result column="SURRENDERIND" jdbcType="VARCHAR" property="surrenderind" />
    <result column="FIRSTLOSSRATE" jdbcType="DECIMAL" property="firstlossrate" />
    <result column="KINDIND" jdbcType="VARCHAR" property="kindind" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="FLAG" jdbcType="VARCHAR" property="flag" />
    <result column="UWCOUNT" jdbcType="DECIMAL" property="uwcount" />
    <result column="UWPREMIUM" jdbcType="DECIMAL" property="uwpremium" />
    <result column="ORIGINUWPREMIUM" jdbcType="DECIMAL" property="originuwpremium" />
    <result column="ORIGINGROSSPREMIUM" jdbcType="DECIMAL" property="origingrosspremium" />
    <result column="RELATEDIND" jdbcType="VARCHAR" property="relatedind" />
    <result column="ENDORADJUSTRATE" jdbcType="DECIMAL" property="endoradjustrate" />
    <result column="PUBINSUREDIND" jdbcType="VARCHAR" property="pubinsuredind" />
    <result column="SPECIALIND" jdbcType="VARCHAR" property="specialind" />
    <result column="SUBPOLICYNO" jdbcType="VARCHAR" property="subpolicyno" />
    <result column="MUSTINSUREIND" jdbcType="VARCHAR" property="mustinsureind" />
    <result column="PREMIUMTYPE" jdbcType="VARCHAR" property="premiumtype" />
    <result column="VALUETYPE" jdbcType="VARCHAR" property="valuetype" />
    <result column="FRANCHISE" jdbcType="DECIMAL" property="franchise" />
    <result column="RESPECIALIND" jdbcType="VARCHAR" property="respecialind" />
    <result column="RISEPROPORTION" jdbcType="DECIMAL" property="riseproportion" />
    <result column="SUMORIGINALINSURED" jdbcType="DECIMAL" property="sumoriginalinsured" />
    <result column="RISKPACKAGECODE" jdbcType="VARCHAR" property="riskpackagecode" />
    <result column="NOTAXPREMIUM" jdbcType="DECIMAL" property="notaxpremium" />
    <result column="VALUEADDEDTAX" jdbcType="DECIMAL" property="valueaddedtax" />
  </resultMap>
  <sql id="Base_Column_List">
    POLICYNO, RISKCODE, PLANCODE, ITEMKINDNO, ITEMNO, ITEMCODE, ITEMDETAILNO, ITEMDETAILCODE, 
    ITEMDETAILLIST, PROJECTCODE, LIABCODE, KINDCODE, KINDNAME, MODECODE, MODENAME, STARTDATE, 
    ENDDATE, CALCULATEIND, CURRENCY, UNITVALUE, UNITINSURED, UNITPREMIUM, QUANTITY, UNIT, 
    SUMVALUE, SUMINSURED, RATEPERIOD, RATE, SHORTRATEFLAG, SHORTRATE, SHORTRATENUMERATOR, 
    SHORTRATEDENOMINATOR, BASEPREMIUM, BENCHMARKPREMIUM, LOADING, GROSSPREMIUM, DISCOUNT, 
    ADJUSTRATE, NETPREMIUM, DEDUCTIBLERATE, DEDUCTIBLE, PREMIUMFORMULA, YEARPREMIUM, 
    SURRENDERIND, FIRSTLOSSRATE, KINDIND, REMARK, FLAG, UWCOUNT, UWPREMIUM, ORIGINUWPREMIUM, 
    ORIGINGROSSPREMIUM, RELATEDIND, ENDORADJUSTRATE, PUBINSUREDIND, SPECIALIND, SUBPOLICYNO, 
    MUSTINSUREIND, PREMIUMTYPE, VALUETYPE, FRANCHISE, RESPECIALIND, RISEPROPORTION, SUMORIGINALINSURED, 
    RISKPACKAGECODE, NOTAXPREMIUM, VALUEADDEDTAX
  </sql>
  <select id="selectByPrimaryKey" parameterType="com.chinacoal.ins.proposal.car.pojo.GuPolicyItemKindKey" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from GUPOLICYITEMKIND
    where POLICYNO = #{policyno,jdbcType=VARCHAR}
      and RISKCODE = #{riskcode,jdbcType=VARCHAR}
      and PLANCODE = #{plancode,jdbcType=VARCHAR}
  </select>
  
  <select id="findSyxBySubPolicyNo" parameterType="java.lang.String" resultType="com.chinacoal.ins.proposal.car.vo.GuPolicyItemKindVo">
    select
      sum(t.SumInsured) as jqxSumAmount,
      sum(t.BenchmarkPremium) as jqxSumBasePremium,
      sum(t.GrossPremium) as jqxSumPremium,
      max(t.ShortRate) as jqxShortPeriodRate,
      max(t.Discount) as jqxPolicyRate
    from GUPOLICYITEMKIND t
    <where>
      <if test="_parameter != null">
        t.SUBPOLICYNO = #{subPolicyNo,jdbcType=VARCHAR}
      </if>
    </where>
  </select>
  <select id="findJqxBySubPolicyNo" parameterType="java.lang.String" resultType="com.chinacoal.ins.proposal.car.vo.GuPolicyItemKindVo">
    select
      sum(t.SumInsured) as jqxSumAmount,
      sum(t.BenchmarkPremium) as jqxSumBasePremium,
      sum(t.GrossPremium) as jqxSumPremium,
      max(t.ShortRate) as jqxShortPeriodRate,
      max(t.Discount) as jqxPolicyRate
    from GUPOLICYITEMKIND t
    <where>
      <if test="_parameter != null">
        t.SUBPOLICYNO = #{subPolicyNo,jdbcType=VARCHAR}
      </if>
    </where>
  </select>

  <!-- 根据保单号查询Kind信息 -->
  <select id="findKindsByPolicyNo" parameterType="java.lang.String" resultType="com.chinacoal.ins.proposal.car.pojo.GuPolicyItemKind">
    select
       t.KindName         as kindName,
       t.KindCode         as kindCode,
       t.StartDate        as startDate,
       t.EndDate          as endDate,
       t.ShortRate        as shortRate,
       t.SumInsured       as sumInsured,
       t.Rate             as rate,
       t.Remark           as remark,
       t.basePremium      as basePremium,
       t.BenchmarkPremium as benchmarkPremium,
       t.GrossPremium     as grossPremium,
       t.RelatedInd       as relatedInd,
       t.KindInd          as KindInd,
       t.ValueType        as valueType,
       t.Quantity         as quantity,
       t.UnitInsured      as unitInsured,
       t.Deductible       as deductible,
       t.franchise        as franchise
  from gupolicyitemkind t
  <where>
    <if test="_parameter != null">
      t.POLICYNO =#{policyNo,jdbcType=VARCHAR}
    </if>
  </where>
  </select>
</mapper>